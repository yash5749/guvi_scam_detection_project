<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Honeypot Multi-Message Tester</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6fb;
      padding: 30px;
    }

    .card {
      max-width: 800px;
      margin: auto;
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 0 25px rgba(0,0,0,0.15);
    }

    h2 {
      margin-bottom: 20px;
    }

    label {
      font-weight: bold;
      display: block;
      margin-top: 15px;
    }

    input, textarea {
      width: 100%;
      padding: 12px;
      margin-top: 8px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 15px;
    }

    button {
      margin-top: 20px;
      width: 100%;
      padding: 15px;
      background: #4a63f5;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background: #3648d6;
    }

    pre {
      background: #111;
      color: #0f0;
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
      overflow-x: auto;
      height: 300px;
      overflow-y: scroll;
    }
  </style>
</head>

<body>
  <div class="card">
    <h2>üîê Honeypot Multi-Turn Conversation Tester</h2>

    <!-- Endpoint -->
    <label>API Endpoint</label>
    <input
      id="endpoint"
      value=" https://guvi-scam-detection-project.onrender.com/process/public"
    />

    <!-- API Key -->
    <label>API Key</label>
    <input
      id="apiKey"
      value="hackathon_key_2024"
    />

    <!-- Session ID -->
    <label>Session ID</label>
    <input
      id="sessionId"
      value="session_multi_test"
    />

    <!-- Start Button -->
    <button onclick="runConversation()">
      üöÄ Start Automated Scam Conversation
    </button>

    <!-- Output -->
    <pre id="output">Conversation output will appear here...</pre>
  </div>

  <script>
    function log(msg) {
      const output = document.getElementById("output");
      output.textContent += msg + "\n";
      output.scrollTop = output.scrollHeight;
    }

    // ‚úÖ Scam Conversation Script (15 messages)
    const scamMessages = [
      "Hello sir, you won ‚Çπ10,00,000 lottery prize!",
      "To claim, send your bank account details immediately.",
      "Your account will be blocked if you don‚Äôt verify now.",
      "Pay a small processing fee of ‚Çπ500 first.",
      "Send money to UPI: scam@bank",
      "Click this link to update details: http://fakebank-login.com",
      "Share OTP sent to your phone for confirmation.",
      "Urgent! Only 10 minutes left.",
      "We are from RBI support team.",
      "Transfer ‚Çπ2000 now to release funds.",
      "Confirm your Aadhaar-linked mobile number.",
      "Your reward is waiting. Don‚Äôt delay.",
      "Final warning: account suspension soon.",
      "Send UPI immediately: fraud@ybl",
      "Thank you. Payment required again."
    ];

    async function runConversation() {
      const endpoint = document.getElementById("endpoint").value;
      const apiKey = document.getElementById("apiKey").value;
      const sessionId = document.getElementById("sessionId").value;

      let conversationHistory = [];

      log("üöÄ Starting automated scam conversation...\n");

      for (let i = 0; i < 9; i++) {
        const scamText = scamMessages[i];

        // Build request body
        const requestBody = {
          sessionId: sessionId,

          message: {
            sender: "scammer",
            text: scamText,
            timestamp: Date.now()
          },

          conversationHistory: conversationHistory,

          metadata: {
            channel: "SMS",
            language: "English",
            locale: "IN"
          }
        };

        log("üì® Scammer: " + scamText);

        try {
          const response = await fetch(endpoint, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "Accept": "application/json",
              "x-api-key": apiKey
            },
            body: JSON.stringify(requestBody)
          });

          const data = await response.json();

          log("ü§ñ Agent Reply: " + data.reply);
          log("--------------------------------------------------");

          // Update conversation history
          conversationHistory.push({
            sender: "scammer",
            text: scamText,
            timestamp: Date.now()
          });

          conversationHistory.push({
            sender: "agent",
            text: data.reply,
            timestamp: Date.now()
          });

          // Delay between messages (simulate real chat)
          await new Promise(resolve => setTimeout(resolve, 800));

        } catch (err) {
          log("‚ùå Error: " + err.message);
          break;
        }
      }

      log("\n‚úÖ Conversation finished. Check backend final callback.");
    }
  </script>
</body>
</html>
